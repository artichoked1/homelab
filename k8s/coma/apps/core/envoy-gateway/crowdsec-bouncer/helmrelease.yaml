apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: envoy-proxy-bouncer
  namespace: envoy-gateway-system
spec:
  chart:
    spec:
      chart: envoy-proxy-bouncer
      reconcileStrategy: ChartVersion
      sourceRef:
        kind: HelmRepository
        name: envoy-proxy-crowdsec-bouncer
        namespace: flux-system
      version: 0.3.0
  interval: 1m0s
  values:
    config:
      bouncer:
        metrics: true
        lapiURL: http://crowdsec-service.crowdsec.svc.cluster.local:8080
        apiKeySecretRef:
          name: envoy-bouncer-api-key
          key: key
    referenceGrant:
      create: true
      fromNamespaces:
        - media
    waf:
      enabled: true
      appSecURL: http://crowdsec-appsec-service.crowdsec.svc.cluster.local:7422
      appSecKeySecretRef:
        name: envoy-bouncer-api-key
        key: appsec-key
